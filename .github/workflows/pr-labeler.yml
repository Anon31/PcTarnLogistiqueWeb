name: PR Auto Labeler

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

permissions:
  pull-requests: write
  contents: read

jobs:
  label:
    runs-on: ubuntu-latest
    steps:
      - name: Apply label from PR title
        uses: actions/github-script@v7
        with:
          script: |
            const title = context.payload.pull_request.title;

            const rules = [
              { label: 'feature', regex: /^feat(\([^)]+\))?:/ },
              { label: 'fix', regex: /^fix(\([^)]+\))?:/ },
              { label: 'documentation', regex: /^docs(\([^)]+\))?:/ },
              { label: 'style', regex: /^style(\([^)]+\))?:/ },
              { label: 'refactor', regex: /^refactor(\([^)]+\))?:/ },
              { label: 'test', regex: /^test(\([^)]+\))?:/ },
              { label: 'chore', regex: /^chore(\([^)]+\))?:/ },
              { label: 'cicd', regex: /^(cicd|ci)(\([^)]+\))?:/ }
            ];

            const match = rules.find(r => r.regex.test(title));

            if (!match) {
              core.info('No matching label found for title.');
              return;
            }

            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              labels: [match.label],
            });

            core.info(`Label "${match.label}" applied.`);