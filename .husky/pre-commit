#!/bin/sh

echo "------------------------------------------------"
echo "ü§ñ HUSKY : V√©rification du nom de la branche..."
echo "------------------------------------------------"

# R√©cup√©rer le nom de la branche
branch_name=$(git rev-parse --abbrev-ref HEAD)

echo "Branche actuelle : '$branch_name'"

# Liste des branches ignor√©es
if [ "$branch_name" = "master" ] || [ "$branch_name" = "main" ] || [ "$branch_name" = "develop" ]; then
  echo "‚úÖ Branche prot√©g√©e/principale. V√©rification ignor√©e."
  exit 0
fi

# Regex de validation
valid_branch_regex="^(feat|fix|hotfix|docs|chore|style|refactor|test|cicd)\/[a-z0-9-]+(\/[a-z0-9-]+)?$"

if ! echo "$branch_name" | grep -Eq "$valid_branch_regex"; then
  echo "‚ùå ERREUR : Nom de branche invalide !"
  echo "------------------------------------------------"
  echo "Le nom '$branch_name' ne respecte pas la convention."
  echo "Format attendu : type/contexte/description-courte"
  echo "Exemples valides :"
  echo "  - feat/front/login-page"
  echo "  - fix/api/user-controller"
  echo "  - chore/docker/setup"
  echo "------------------------------------------------"
  echo "üö´ COMMIT BLOQU√â."
  exit 1
fi

echo "‚úÖ Nom de branche valide. Commit autoris√©."
exit 0