#!/bin/sh

# RÃ©cupÃ©ration plus robuste du nom de la branche
branch_name=$(git rev-parse --abbrev-ref HEAD)

# Si on est en mode "HEAD dÃ©tachÃ©e" (cas rare mais possible), on ignore la vÃ©rif
if [ "$branch_name" = "HEAD" ]; then
  exit 0
fi

# Liste des branches ignorÃ©es (ex: master, main, develop)
if [ "$branch_name" = "master" ] || [ "$branch_name" = "main" ] || [ "$branch_name" = "develop" ]; then
  exit 0
fi

# Regex de validation : type/scope/description ou type/description
# Types autorisÃ©s : feat, fix, hotfix, docs, chore, style, refactor, test, cicd
valid_branch_regex="^(feat|fix|hotfix|docs|chore|style|refactor|test|cicd)\/[a-z0-9-]+(\/[a-z0-9-]+)?$"

if ! echo "$branch_name" | grep -Eq "$valid_branch_regex"; then
  echo "âŒ Erreur : Le nom de la branche '$branch_name' ne respecte pas la convention."
  echo "ğŸ‘‰ Format attendu : type/contexte/description-courte"
  echo "ğŸ‘‰ Exemple : feat/front/login-page"
  echo "ğŸš« Commit bloquÃ©. Renommez votre branche avec : git branch -m nouveau-nom"
  exit 1
fi
